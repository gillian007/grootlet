/**** @Preserve
 The Ink & Parchment Map v1.7.0

 Copyright 2014 Glenn Fisher

 This is an unofficial mapping system for Minecraft. It is neither produced nor 
 endorsed by Mojang.

 Licenced under GPL licence, version 3 or later
 https://www.gnu.org/copyleft/gpl.html

 Note that other files in this project have their own licence, see \licence.md
*****/
function isEmpty(e){return!e||0===e.length}function isString(e){return"string"==typeof e||e instanceof String}function isNotEmptyString(e){return("string"==typeof e||e instanceof String)&&e.length>0}function isFunction(e){return"function"==typeof e}function stringToBool(e){switch(trim(e).toLowerCase()){case"true":case"on":case"yes":case"1":return!0;case"false":case"off":case"no":case"0":case null:return!1;default:return Boolean(string)}}function imageToCanvas(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}function trimRight(e){return isFunction(e.trimRight)?e.trimRight():e.replace(/\s+$/,"")}function trimLeft(e){return isFunction(e.trimLeft)?e.trimLeft():e.replace(/^\s+/,"")}function trim(e){return isFunction(e.trim)?e.trim():e.replace(/^\s+|\s+$/g,"")}function parseURL(e){var t=document.createElement("a");return t.href=e,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,a={},i=t.search.replace(/^\?/,"").split("&"),n=i.length,r=0;n>r;r++)i[r]&&(e=i[r].split("="),a[e[0]]=e[1]);return a}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}}function isImageOk(e){return e.complete?"undefined"!=typeof e.naturalWidth&&0==e.naturalWidth?!1:!0:!1}function MapConfiguration(){}function SuppressableLabel(e,t){this.text=e,this.displayOverride=void 0===t?LabellingStyleOverride.normal:t,this.suppress=this.displayOverride==LabellingStyleOverride.suppress,this.always=this.displayOverride==LabellingStyleOverride.always}function Location(e,t,a,i,n,r,o){this.x=e,this.z=t,this.type=a,this.labelOverride=SuppressableLabel.parse(i),this.hrefOverride=r,this.iconIndexOverride=o,this.owner=SuppressableLabel.parse(n)}function HrefAndTarget(e){if(this.target=gHrefTargetDefault,isEmpty(e))this.href="";else if("_"==e[0]){var t=e.indexOf("_",1);t>0?(this.target=e.substring(0,t),this.href=e.substring(t+1)):this.href=e}else this.href=e}function Rectangle(e,t,a,i){this.x1=Math.min(e,a),this.y1=Math.min(t,i),this.x2=Math.max(e,a),this.y2=Math.max(t,i),this.width=1+a-e,this.height=1+i-t}function SetDefaultSrc(e){isString(e)?gMapDataUriDefault=e:alert("SetDefaultSrc() was passed a non-string value")}function SetDefaultHrefTarget(e){isString(e)?gHrefTargetDefault=e:alert("SetDefaultHrefTarget() was passed a non-string value")}function createLocationFromRow(e,t){var a,i=null;try{CSV.DETECT_TYPES=!1,CSV.TRIM_UNQUOTED_VALUES=!0,CSV.EXPAND_QUOTED_NEWLINES=!0,a=CSV.parse(t)[0]}catch(n){alert("Could not parse comma seperated values for entry/line "+e.toString()+": "+n)}var r=a[0];if("?"==r[r.length-1]&&(r=r.substring(0,r.length-1)),r in LocationType){var o=LocationType[r],s=parseInt(a[1]),h=parseInt(a[2]),l=parseInt(a[6]);isNaN(s)||isNaN(h)||(i=new Location(s,h,o,unquoteString(a[3]),unquoteString(a[4]),unquoteString(a[5]),l))}return i}function unquoteString(e){var t=e;if(isString(e)&&e.length>=2&&'"'==e[0]&&'"'==e[e.length-1]){var a=jQuery.parseJSON('{"value":'+e+"}");t=a.value}return t}function parseTextLocations(e,t){var a=new MapConfiguration,i=[],n=e.split("\n"),r=0;for(r=0;r<n.length;r++){var o=n[r];if("/"!=o[0]){var s=createLocationFromRow(r+1,n[r]);s instanceof Location?i.push(s):a.AssignFromRow(n[r])}}t(a,i)}function parseHtmlLocations(e,t){function a(e){var t=e,a=trim(e),i=a.length>=2&&'"'==a[0]&&'"'==a[a.length-1];return i||(a.indexOf(",")>=0||a.indexOf('"')>=0)&&(t='"'+a.replace(/"/g,'""')+'"'),t}var i=new MapConfiguration,n=[],r=jQuery.parseHTML(e),o=0;$(r).find("tr").each(function(){var e="";o++,$(this).find("td").each(function(){e+=a(this.textContent)+","});var t=createLocationFromRow(o,e);t instanceof Location?n.push(t):i.AssignFromRow(e)}),o=0,$(r).find("ul, ol").each(function(){$(this).find("li").each(function(){o++;var e=createLocationFromRow(o,this.textContent);e instanceof Location?n.push(e):i.AssignFromRow(this.textContent)})}),t(i,n)}function createMapImageInDiv(e,t,a,i,n,r,o){var s=document.createElement("canvas");s.width=a,s.height=i;var h;h=e<n.HideLabelsAbove?LabellingStyle.none:e>=n.ShowLabelsBelow?LabellingStyle.all:LabellingStyle.smart,drawMapDetails(s,n,r,h);var l=CreateAreaMapInDiv(t,a,i,n,r),c=$(document.createElement("img")).css("display","block")[0],g=$.Deferred();c.onload=function(){g.resolve()},c.src=s.toDataURL("image/png"),c.useMap="#"+l;var d=document.getElementById(t);$(c).appendTo(d),$.when(g).done(o)}function CreateAreaMapInDiv(e,t,a,i,n){var r=e+"-areamap",o=t>a?t:a,s=i.GetXTranslationFunction(o),h=i.GetZTranslationFunction(o),l=document.createElement("map");l.name=r;var c;for(c=0;c<n.length;++c){var g=n[c],d=g.getHrefAndTarget(),p=!1,m=document.createElement("area");isEmpty(d.href)||(m.href=d.href,m.target=d.target,p=!0);var f=generateHtmlLabel(g,i.ShowCoordinates&&!i.DisableCoordinates);f.length>0&&($(m).mouseover(CreateHandler_mouseover(f)),$(m).mouseout(Handle_mouseout),p=!0),p&&(m.shape="circle",m.coords=[s(g.x),h(g.z),cClickRadius*gLocationIconScale],m.alt=g.getAlt(),$(m).appendTo(l))}return $(l).appendTo(document.getElementById(e)),r}function CreateHandler_mouseover(e){return function(){$("#locationDesc").empty(),$("#locationDesc").append(e),$("#hoverFrame").removeClass("hidden-hoverFrame")}}function Handle_mouseout(){$("#hoverFrame").addClass("hidden-hoverFrame"),$("#locationDesc").empty()}function generateHtmlLabel(e,t){var a="",i=e.getLabel();isNotEmptyString(i)&&(i=strToHtml(trim(i)));var n=e.owner.text;isNotEmptyString(n)&&(n=strToHtml(trim(n)));var r=isNotEmptyString(n)?i.indexOf(n):-1,o='<span class="locationHoverOwner">'+n+"</span>",s=!0;if(isNotEmptyString(i)&&i!=n){var h=i;r>=0&&(h=i.substring(0,r)+o+i.substring(r+n.length),s=!1),h='<span class="locationHoverPlacename">'+h+"</span>",a=h,isNotEmptyString(n)&&s&&(a+="<br/>")}return isNotEmptyString(n)&&s&&(a+=o),isNotEmptyString(a)&&t&&(a+='<span class="locationHoverCoordinates"><br/>'+e.x+", "+e.z+"</span>"),isNotEmptyString(a)&&isNotEmptyString(e.getHrefAndTarget(!0).href)&&(a+='<div style="height: 11px"><img src="img/link.png" height="7" style="vertical-align: middle"></div>'),a}function strToHtml(e){return e.replace("\n"," ").replace("&","&amp;").replace("<","&lt;").replace(">","&gt;")}function drawMapDetails(e,t,a,i){function n(e){return e.split(/\r\n|\n|\r/)}function r(e,t,a){var i;"BoundsAtOrigin"in e?i=e.BoundsAtOrigin:(i=o(0,a,t,1),e.BoundsAtOrigin=i);var n,r=[];for(n=0;n<i.length;n++)r[n]=i[n].copy(v(e.x),x(e.z));return r}function o(e,t,a,i){var r=[];if(0>i||i>0||(i=0),!isEmpty(a)){var o,s=1*gLocationFontScale,h=n(a);for(o=0;o<h.length;o++){var l=f.measureText(h[o]).width,c=f.measureText(trimLeft(h[o])).width,g=f.measureText(trimRight(h[o])).width,d=l-c,p=l-g,u=e-(l-1)/2,w=t+s;r[o]=new Rectangle(u+d-i,w-m-i,u+(l-1)-p+i,w+i),s+=m}}return r}function s(e,t,a){var i=0;if(!isEmpty(a)){var r,o=n(a);for(r=0;r<o.length;r++)f.fillText(o[r],e-f.measureText(o[r]).width/2,t+i),i+=m}}function h(e){var t;if(isNaN(e)||0>e)t={width:0,height:0,yOffset:0,pixelArt:!0};else{var a=IconBoundsInformation[e];t=void 0===a?{width:20,height:20,yOffset:0,pixelArt:!0}:1==gLocationIconScale?a:{width:a.width,height:a.height,yOffset:a.yOffset,pixelArt:a.pixelArt}}return t.width*=gLocationIconScale,t.height*=gLocationIconScale,t.yOffset*=gLocationIconScale,t}function l(e,t,a){var i=[];if(isNaN(e)||0>e);else{var n=h(e);if(0!=n.width&&0!=n.height){var r=t-n.width/2,o=a+n.yOffset-n.height/2;i[0]=new Rectangle(r,o,r+n.width-1,o+n.height-1)}}return i}function c(e,t,a,i){!isNaN(e)&&e>=0&&(e>=cCustomIconIndexStart?gCustomIconsLoaded&&drawGlyph(f,gCustomIcons,e-cCustomIconIndexStart,!0,t,a,i):drawGlyph(f,w,e,IconBoundsInformation[e].pixelArt,t,a,i))}function g(e,t){var a="",n=v(e.x),o=x(e.z),g=Math.max(u/128,8*gLocationIconScale);if(n>g&&o>g&&u-g>n&&u-g>o){if(isEmpty(e.labelOverride.text)||e.labelOverride.suppress?isEmpty(e.owner.text)||e.owner.suppress||(a+=e.owner.text):a+=e.labelOverride.text,isEmpty(e.owner.text)||-1!=a.indexOf(e.owner.text)||e.owner.suppress||(a+="\n("+e.owner.text+")"),!isEmpty(a)&&t==S.Captions&&i!=LabellingStyle.none){var d,p=e.getIconIndex();if(isNaN(p)||0>p)d=3*gLocationFontScale;else{var m=h(p);d=cCaptionSpacer_vertical*gLocationFontScale+m.yOffset+m.height/2}var w=!0,O=e.labelOverride.always||e.owner.always;if(i==LabellingStyle.smart){var I,C=r(e,a,d);for(I=0;I<C.length;I++){var b,M=C[I];for(b=0;b<y.length;b++)if(M.intersects(y[b])){var L=l(e.getIconIndex(),n,o,0);if(0==L.length||!L[0].equals(y[b])){w=!1;break}}if(!w)break}(w||O)&&(y=y.concat(C))}if((w||O)&&s(n,o+d,a),cShowBoundingBoxes){f.lineWidth=1,f.strokeStyle="#0000FF";var b,T=r(e,a);for(b=0;b<T.length;b++)T[b].stroke(f)}}t==S.Masks&&c(e.getIconIndex(),!0,n,o),isEmpty(a)?t==S.UncaptionedIcons&&c(e.getIconIndex(),!1,n,o):t==S.CaptionedIcons&&c(e.getIconIndex(),!1,n,o)}}function d(){var e=8*gLocationIconScale,t=Math.round(v(0)),a=Math.round(x(0));f.lineWidth=2*gLocationIconScale,f.strokeStyle="#6e5830",f.moveTo(t,a-e),f.lineTo(t,a+e),f.moveTo(t-e,a),f.lineTo(t+e,a),f.stroke()}function p(){var a=$("#map-background").width(),i=2*t.MapRange/a,n=Math.round(i).toString(),r=e.width/a,o=5,h=Math.round(6*r),l=Math.round(($("#map-background").height()-6)*r),c=Math.round(.4*r);f.lineWidth=2*gLocationFontScale,f.strokeStyle="#6e5830",f.moveTo(h,l),f.lineTo(h+Math.round(r*o),l),f.lineTo(h+Math.round(r*o),l+c),f.moveTo(h,l-c),f.lineTo(h,l+c),f.moveTo(h+Math.round(r),l-c),f.lineTo(h+Math.round(r),l),f.stroke();var g=l-c-4,d=l+c+m;s(h+r,g,n),s(h,d,"0"),s(h+r*o,d,Math.round(i*o).toString())}var m=10*gLocationFontScale,f=e.getContext("2d"),u=e.width>e.height?e.width:e.height,w=document.getElementById("map-tileset"),v=t.GetXTranslationFunction(u),x=t.GetZTranslationFunction(u),y=[],S={Masks:0,Origin:1,Captions:2,UncaptionedIcons:3,CaptionedIcons:4,Scale:5,First:0,Last:5},O=document.getElementById("map-background");setCanvasScalingToPixelated(f),f.drawImage(O,0,0,e.width,e.height),f.lineWidth=1,f.strokeStyle="#FF00FF";var I;for(I=0;I<a.length;I++){var C=a[I],b=l(C.getIconIndex(),v(C.x),x(C.z),0);b.length>0&&(y[y.length]=b[0],cShowBoundingBoxes&&b[0].stroke(f))}f.font=m+"px Arial",f.font=m+"px 'Merienda', Arial, sans-serif",gLocationFontScale>1&&(f.fillStyle="#553A24");var M;for(M=S.First;M<=S.Last;M++)if(M==S.Origin)t.ShowOrigin&&d();else if(M==S.Scale)t.ShowScale&&p();else if(M==S.Captions){var L;for(L=0;L<a.length;L++)g(a[L],M)}else{var L;for(L=a.length-1;L>=0;L--)g(a[L],M)}}function setCanvasScalingToPixelated(e,t){void 0===t&&(t=!0),e.mozImageSmoothingEnabled=!t,e.webkitImageSmoothingEnabled=!t,e.msImageSmoothingEnabled=!t,e.imageSmoothingEnabled=!t}function PreRender(e){if(null!=gOceanMapImage){var t=document.getElementById("map-background"),a=renderOcean(e,t,gOceanMapImage);t.src=a.toDataURL("image/png")}}function drawGlyph(e,t,a,i,n,r,o){var s=t.height/2,h=s/2*gLocationIconScale;1!=gLocationIconScale&&setCanvasScalingToPixelated(e,i&&!n),e.drawImage(t,a*s,n?s:0,s,s,r-h,o-h,s*gLocationIconScale,s*gLocationIconScale)}function renderOcean(e,t,a){if(0==a.width)return alert("Invalid ocean mask - width 0"),imageToCanvas(t);var i=a.width/2,n=a.height/2,r=Math.round(2*e.MapRange/cOceanBlocksPerPixel),o=Math.round(i+(e.X-e.MapRange)/cOceanBlocksPerPixel),s=Math.round(n+(e.Z-e.MapRange)/cOceanBlocksPerPixel),h=0>o?0:o,l=0>s?0:s,c=r-(h-o),g=r-(l-s);c=c>a.width?a.width:c,g=g>a.height?a.height:g;var d=t.width/r,p=Math.round((h-o)*d),m=Math.round((l-s)*d),f=Math.round(c*d),u=Math.round(g*d),w=f*cWorkingCanvasOversample,v=u*cWorkingCanvasOversample,x=document.createElement("canvas");x.width=w,x.height=v,workingContext=x.getContext("2d"),workingContext.drawImage(a,h,l,c,g,0,0,w,v);var y=e.OceanTheme.toLowerCase();return"darkseas"==y?renderTheme_DarkSeas(e,t,x,p,m,f,u):"coastalrelief"==y?renderTheme_CoastalRelief(e,t,x,p,m,f,u):renderTheme_BlueCoastline(e,t,x,p,m,f,u)}function renderTheme_BlueCoastline(e,t,a,i,n,r,o){var s=new RGB(127,130,146),h=new RGB(0,30,30),l=new RGB(243,226,194),c=new RGB(208,177,120),g=Math.round(204),d=Math.round(153),p=Math.round(51),m=CreateWorkingCanvas(e,a,r,o),f=m.getContext("2d"),u=m.width,w=m.height,v=a,x=Math.round(cWorkingCanvasOversample*t.width/8),y=3200/e.MapRange;y>3&&(y=3),x*=y,stackBlurCanvasRGB(v,0,0,v.width,v.height,x);var S,O=v.getContext("2d").getImageData(0,0,v.width,v.height).data,I=f.getImageData(0,0,u,w),C=I.data,b=new Array(256),M=new Array(256),L=new Array(256);for(S=0;S<b.length;S++){var T=S/255,A=s.Blend(l,T),B=.5/y;.5>B?B=.5:B>.7&&(B=.7),B>=T&&(A=A.Blend(h,.5-.5*T/B)),b[S]=A.R,M[S]=A.G,L[S]=A.B}var D=c.R,R=c.G,k=c.B,E=4*v.width/u,F=4*v.width*(v.height/w-1),U=0,N=0,H=0,G=0;for(N=0;w>N;N++){for(U=0;u>U;U++){blurPixel=O[G];var _,$=C[H]>128&&blurPixel>75;if($)_=p,C[H]=D,C[H+1]=R,C[H+2]=k;else{var P=(255-blurPixel)/255;_=Math.round(g*(1-P)+d*P);var W=Math.round(.7*(255-blurPixel));W>255&&(W=255),0>W&&(W=0),C[H]=b[W],C[H+1]=M[W],C[H+2]=L[W]}C[H+3]=_,H+=4,G+=E}G+=F}f.putImageData(I,0,0);var q=cloneCanvas(t),z=q.getContext("2d");return z.drawImage(m,0,0,u,w,i,n,r,o),ApplyMapEdgesToCanvas(q,t,1,1)}function renderTheme_DarkSeas(e,t,a,i,n,r,o){var s=new RGB(144,104,67),h=new RGB(249,232,206),l=Math.round(178.5),c=Math.round(51),g=Math.round(63.75),d=CreateWorkingCanvas(e,a,r,o),p=d.getContext("2d"),m=d.width,f=d.height,u=a,w=Math.round(cWorkingCanvasOversample*t.width/8),v=3200/e.MapRange;v>3&&(v=3),w*=v,stackBlurCanvasRGB(u,0,0,u.width,u.height,w);var x=u.getContext("2d").getImageData(0,0,u.width,u.height).data,y=p.getImageData(0,0,m,f),S=y.data,O=h.R,I=h.G,C=h.B,b=s.R,M=s.G,L=s.B,T=4*u.width/m,A=4*u.width*(u.height/f-1),B=0,D=0,R=0,k=0;for(D=0;f>D;D++){for(B=0;m>B;B++){blurPixel=x[k];var E,F=S[R]>128&&blurPixel>75;F?(E=g,S[R]=O,S[R+1]=I,S[R+2]=C):(E=Math.round(blurPixel*(l-c)/255)+c,S[R]=b,S[R+1]=M,S[R+2]=L),S[R+3]=E,R+=4,k+=T}k+=A}p.putImageData(y,0,0);var U=cloneCanvas(t),N=U.getContext("2d");return N.drawImage(d,0,0,m,f,i,n,r,o),ApplyMapEdgesToCanvas(U,t,1,1)}function renderTheme_CoastalRelief(e,t,a,i,n,r,o){var s=new RGB(144,104,67),h=s.Blend(cColor_Black,.45),l=CreateWorkingCanvas(e,a,r,o),c=l.getContext("2d"),g=l.width,d=l.height,p=a,m=Math.round(cWorkingCanvasOversample*t.width/20);stackBlurCanvasRGB(p,0,0,p.width,p.height,m);var f=p.getContext("2d").getImageData(0,0,p.width,p.height).data,u=c.getImageData(0,0,g,d),w=u.data,v=h.R,x=h.G,y=h.B,S=4*p.width/g,O=4*p.width*(p.height/d-1),I=0,C=0,b=0,M=0;for(C=0;d>C;C++){for(I=0;g>I;I++){var L=255-w[b],T=f[M];w[b]=v,w[b+1]=x,w[b+2]=y,w[b+3]=T>L?L:T,b+=4,M+=S}M+=O}c.putImageData(u,0,0);var A=cloneCanvas(t),B=A.getContext("2d");return B.drawImage(l,0,0,g,d,i,n,r,o),ApplyMapEdgesToCanvas(A,t,1,0)}function CreateWorkingCanvas(e,t,a,i){(t.width%a!=0||t.height%i!=0||t.width/a!=cWorkingCanvasOversample)&&alert("CreateWorkingCanvas called with transformedOceanMask_Canvas size not a multiple of output size");var n=document.createElement("canvas");if(e.HardCoastlines){n.width=a,n.height=i;var r=n.getContext("2d");r.drawImage(t,0,0,t.width,t.height,0,0,a,i)}else n=cloneCanvas(t);return n}function ApplyMapEdgesToCanvas(e,t,a,i,n){void 0===a&&(a=2),void 0===i&&(i=4),void 0===n&&(n=0);var r=cloneCanvas(t),o=r.getContext("2d"),s=o.getImageData(0,0,r.width,r.height),h=s.data,l=e.getContext("2d"),c=l.getImageData(0,0,e.width,e.height),g=c.data,d=new Array(r.width),p=0;for(p=0;p<d.length;p++)d[p]=255;for(p=0;a>p;p++)d[p]=n,d[d.length-(p+1)]=n;for(p=0;i>p;p++){var m=n+Math.round((255-n)*(p+1)/(i+1));d[p+a]=m,d[d.length-(p+1+a)]=m}var f,u,w,v=0,x=0,y=0,S=!1;for(x=0;x<r.height;x++){var O=d[x];for(v=0;v<r.width;v++){if(0==h[y+3])g[y+3]=0;else if(S)if(h[y]==f&&h[y+1]==u&&h[y+2]==w)g[y+3]=0;else{var I=d[v],C=O>I?I:O;g[y+3]=C}else S=!0,f=h[y],u=h[y+1],w=h[y+2],g[y+3]=0;y+=4}}return l.putImageData(c,0,0),o.drawImage(e,0,0),r}function RGB(e,t,a,i){this.R=e,this.G=t,this.B=a,this.A=void 0===i?255:i}function cloneCanvas(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var a=t.getContext("2d");return a.drawImage(e,0,0),t}function createMapsInDivs_Async(e,t,a,i){function n(i,n){return function(){createMapImageInDiv(i,a[i].divName,a[i].width,a[i].height,e,t,function(){n.resolve()})}}PreRender(e);var r,o=[];for(r=0;r<a.length;r++){var s=$.Deferred();setTimeout(n(r,s),1),o[r]=s}$.when.apply($,o).done(i)}function getSettingsAndMapLocations(e,t,a){function i(e){document.title=e.Title,$("#mainTitle").text(e.Title),$("#tagline").text(e.Blurb)}function n(e,t,a){if(isString(e)){var i=new RegExp(".txt$|.csv$","i"),n=i.test(e);$.ajax({url:e,dataType:n?"text":"html",success:function(e,t,i){var r=i.getResponseHeader("content-type")||"";r.indexOf("text/plain")>=0||r.indexOf("text/csv")>=0||n?parseTextLocations(e,a):parseHtmlLocations(e,a)},error:function(a,i,n){alert(e==gMapDataUriDefault?'no "src=" url was specified to scrape the location data from.\n\n(and could not load from the fallback url)':t?'Failed to load locations from src "'+e+'"\nThis might be a Google Doc file instead of a txt file on Google Drive.\n\nThe map viewer cannot read Doc format.':'Failed to load locations from src "'+e+'", something went wrong: '+i+", "+n)}})}else alert("Internal error: dataUrl not string")}function r(e,t){var a=$.Deferred();return isEmpty(e.OceanMapUri)?t?(gOceanMapImage=document.getElementById("oceanmask"),null!=gOceanMapImage?isImageOk(gOceanMapImage)?a.resolve():(gOceanMapImage=null,a=null):a=null):a=null:(gOceanMapImage=new Image,$(gOceanMapImage).bind({load:function(){a.resolve()},error:function(){gOceanMapImage=null,a.resolve(),alert('Could not load oceam-map image at "'+e.OceanMapUri+'"')}}),gOceanMapImage.crossOrigin="Anonymous",gOceanMapImage.src=e.OceanMapUri),a}var o=new MapConfiguration;o.AssignFromUrl(location);var s=r(o,!1),h="MapDataUri"in o?o.MapDataUri:gMapDataUriDefault;isNotEmptyString(h)?n(h,1==o.GoogleSrcLooksLikeDoc,function(n,h){var l=new MapConfiguration;l.SetDefaults(e,t),l.AssignFrom(n),l.AssignFrom(o),i(l);var c=[],g=$.Deferred();c[0]=g,isEmpty(l.CustomIconsUri)?g.resolve():($(gCustomIcons).bind({load:function(){gCustomIconsLoaded=!0,g.resolve()},error:function(){g.resolve(),alert('Could not load custom icons image at "'+l.CustomIconsUri+'"')}}),gCustomIcons.src=l.CustomIconsUri),null==s&&(s=r(l,!0)),null!=s&&(c[1]=s),$.when.apply($,c).done(function(){a(l,h)})}):1!=o.Abort&&alert('no "src=" url was specified to scrape the location data from.')}var cMapRangeDefault=3200,cClickRadius=12,cCaptionSpacer_vertical=8,cLabel_DontDrawChar="~",cLabel_AlwaysDrawChar="!",cCustomIconIndexStart=64,cShowBoundingBoxes=!1,gMapDataUriDefault="",gHrefTargetDefault="",gCustomIcons=new Image,gCustomIconsLoaded=!1,gOceanMapImage=null,gLocationIconScale=1,gLocationFontScale=1,LocationType={Village:{iconIndex:0,name:"Plains Village",href:"http://minecraft.gamepedia.com/Village#Plains"},DesertVillage:{iconIndex:1,name:"Desert village",href:"http://minecraft.gamepedia.com/Village#Desert"},SavannahVillage:{iconIndex:0,name:"Savannah village",href:"http://minecraft.gamepedia.com/Village#Savannah"},WitchHut:{iconIndex:3,name:"Witch's hut",href:"http://minecraft.gamepedia.com/Generated_structures#Witch_Huts"},JungleTemple:{iconIndex:4,name:"Jungle temple",href:"http://minecraft.gamepedia.com/Jungle_temple"},DesertTemple:{iconIndex:5,name:"Desert temple",href:"http://minecraft.gamepedia.com/Desert_temple"},NetherFortress:{iconIndex:6,name:"Nether Fortress",href:"http://minecraft.gamepedia.com/Nether_Fortress"},NetherPortal:{iconIndex:7,name:"Portal",href:"http://minecraft.gamepedia.com/Nether_Portal"},Forest:{iconIndex:28,name:"Forest",href:"http://minecraft.gamepedia.com/Biome#Forest"},FlowerForest:{iconIndex:26,name:"Flower forest",href:"http://minecraft.gamepedia.com/Flower_forest"},MushroomIsland:{iconIndex:29,name:"Mushroom island",href:"http://minecraft.gamepedia.com/Mushroom_Island"},Horse:{iconIndex:34,name:"",href:"http://minecraft.gamepedia.com/Horse"},Wolf:{iconIndex:35,name:"",href:"http://minecraft.gamepedia.com/Wolf"},Dragon:{iconIndex:36,name:"",href:""},SeaMonster:{iconIndex:46,name:"",href:""},Ship:{iconIndex:38,name:"",href:""},IcePlainsSpikes:{iconIndex:47,name:"Ice plains spikes",href:"http://minecraft.gamepedia.com/Ice_Plains_Spikes"},Spawn:{iconIndex:40,name:"Spawn",href:""},PlayerStructure:{iconIndex:8,name:"",href:""},PlayerCastle:{iconIndex:9,name:"",href:""},PlayerHouse:{iconIndex:10,name:"",href:""},PlayerFarm:{iconIndex:14,name:"Farm",href:""},PlayerMachine:{iconIndex:12,name:"",href:""},EnchantingRoom:{iconIndex:44,name:"",href:"http://minecraft.gamepedia.com/Enchantment_Table"},Label:{iconIndex:-1,name:"",href:""},FenceOverlay:{iconIndex:13,name:"",href:""},IslandOverlay:{iconIndex:30,name:"",href:""}},LabellingStyle={none:0,smart:1,all:2},LabellingStyleOverride={normal:0,suppress:1,always:2},IconBoundsInformation={0:{width:14,height:14,yOffset:-1,pixelArt:!0},1:{width:14,height:16,yOffset:-1,pixelArt:!0},2:{width:12,height:20,yOffset:0,pixelArt:!0},3:{width:14,height:20,yOffset:-4,pixelArt:!0},4:{width:16,height:17,yOffset:-2,pixelArt:!0},5:{width:10,height:17,yOffset:0,pixelArt:!0},6:{width:10,height:14,yOffset:-2,pixelArt:!0},7:{width:10,height:13,yOffset:-1,pixelArt:!0},8:{width:10,height:10,yOffset:0,pixelArt:!0},9:{width:10,height:14,yOffset:-2,pixelArt:!0},10:{width:12,height:11,yOffset:0,pixelArt:!0},11:{width:15,height:8,yOffset:0,pixelArt:!0},12:{width:10,height:18,yOffset:-4,pixelArt:!0},13:{width:0,height:8,yOffset:5,pixelArt:!0},14:{width:16,height:16,yOffset:-1,pixelArt:!0},15:{width:12,height:13,yOffset:0,pixelArt:!0},16:{width:10,height:10,yOffset:0,pixelArt:!0},17:{width:10,height:10,yOffset:0,pixelArt:!0},18:{width:10,height:10,yOffset:0,pixelArt:!0},19:{width:12,height:12,yOffset:0,pixelArt:!0},20:{width:16,height:16,yOffset:0,pixelArt:!1},21:{width:4,height:18,yOffset:0,pixelArt:!1},22:{width:14,height:24,yOffset:-4,pixelArt:!1},23:{width:15,height:16,yOffset:-1,pixelArt:!0},24:{width:15,height:16,yOffset:-1,pixelArt:!0},25:{width:15,height:16,yOffset:-1,pixelArt:!0},26:{width:20,height:22,yOffset:0,pixelArt:!1},27:{width:20,height:18,yOffset:-3,pixelArt:!1},28:{width:24,height:22,yOffset:-4,pixelArt:!1},29:{width:17,height:16,yOffset:-1,pixelArt:!1},30:{width:0,height:16,yOffset:8,pixelArt:!1},31:{width:30,height:18,yOffset:0,pixelArt:!1},32:{width:30,height:20,yOffset:-1,pixelArt:!1},33:{width:18,height:16,yOffset:-1,pixelArt:!1},34:{width:18,height:17,yOffset:0,pixelArt:!1},35:{width:17,height:13,yOffset:0,pixelArt:!1},36:{width:30,height:26,yOffset:1,pixelArt:!1},37:{width:27,height:27,yOffset:1,pixelArt:!1},38:{width:29,height:30,yOffset:0,pixelArt:!1},39:{width:20,height:27,yOffset:-2,pixelArt:!1},40:{width:14,height:12,yOffset:0,pixelArt:!1},41:{width:18,height:16,yOffset:0,pixelArt:!1},42:{width:14,height:22,yOffset:-4,pixelArt:!1},43:{width:14,height:16,yOffset:-1,pixelArt:!0},44:{width:14,height:16,yOffset:-1,pixelArt:!0},45:{width:11,height:13,yOffset:0,pixelArt:!0},46:{width:28,height:18,yOffset:1,pixelArt:!1},47:{width:28,height:30,yOffset:1,pixelArt:!1}};MapConfiguration.prototype.SetDefaults=function(){var e=0;"HideLabelsAbove"in this||(this.HideLabelsAbove=e),"ShowLabelsBelow"in this||(this.ShowLabelsBelow=3),"MapRange"in this||(this.MapRange=cMapRangeDefault),"Title"in this||(this.Title="Map of the Overworld"),"Blurb"in this||(this.Blurb="Use up/down or mousewheel to zoom, drag to scroll"),"CustomIconsUri"in this||(this.CustomIconsUri=""),"X"in this||(this.X=0),"Z"in this||(this.Z=0),"ShowOrigin"in this||(this.ShowOrigin=!0),"ShowScale"in this||(this.ShowScale=!0),"ShowCoordinates"in this||(this.ShowCoordinates=!1),"DisableCoordinates"in this||(this.DisableCoordinates=!1),"OceanTheme"in this||(this.OceanTheme="BlueCoastline"),"HardCoastlines"in this||(this.HardCoastlines=!1),"OceanMapUri"in this||(this.OceanMapUri="")},MapConfiguration.prototype.AssignFrom=function(e){"MapDataUri"in e&&(this.MapDataUri=e.MapDataUri),"HideLabelsAbove"in e&&(this.HideLabelsAbove=e.HideLabelsAbove),"ShowLabelsBelow"in e&&(this.ShowLabelsBelow=e.ShowLabelsBelow),"MapRange"in e&&(this.MapRange=e.MapRange),"Title"in e&&(this.Title=e.Title),"Blurb"in e&&(this.Blurb=e.Blurb),"CustomIconsUri"in e&&(this.CustomIconsUri=e.CustomIconsUri),"X"in e&&(this.X=e.X),"Z"in e&&(this.Z=e.Z),"ShowOrigin"in e&&(this.ShowOrigin=e.ShowOrigin),"ShowScale"in e&&(this.ShowScale=e.ShowScale),"ShowCoordinates"in e&&(this.ShowCoordinates=e.ShowCoordinates),"DisableCoordinates"in e&&(this.DisableCoordinates=e.DisableCoordinates),"OceanTheme"in e&&(this.OceanTheme=e.OceanTheme),"HardCoastlines"in e&&(this.HardCoastlines=e.HardCoastlines),"OceanMapUri"in e&&(this.OceanMapUri=e.OceanMapUri)},MapConfiguration.prototype.AssignFromRow=function(e){var t=e.indexOf("=");if(t>0){var a=trim(e.substring(0,t)).toLowerCase(),i=trim(e.slice(t+1));if("z"==a){var n=parseInt(i);isNaN(n)||(this.Z=n)}else if("x"==a){var r=parseInt(i);isNaN(r)||(this.X=r)}else if("hidelabelsabove"==a){var o=parseInt(i);isNaN(o)||(this.HideLabelsAbove=o)}else if("showlabelsbelow"==a){var s=parseInt(i);isNaN(s)||(this.ShowLabelsBelow=s)}else if("range"==a){var h=parseInt(i);isNaN(h)||(this.MapRange=h)}else"title"==a&&isString(i)?this.Title=unquoteString(i):"blurb"==a&&isString(i)?this.Blurb=unquoteString(i):"icons"==a&&isString(i)?this.CustomIconsUri=unquoteString(i):"googleicons"==a&&isString(i)?this.CustomIconsUri="https://googledrive.com/host/"+unquoteString(i):"showorigin"==a&&isString(i)?this.ShowOrigin=stringToBool(i):"showscale"==a&&isString(i)?this.ShowScale=stringToBool(i):"showcoordinates"==a&&isString(i)?this.ShowCoordinates=stringToBool(i):"disablecoordinates"==a&&isString(i)?this.DisableCoordinates=stringToBool(i):"oceantheme"==a&&isString(i)?(this.OceanTheme=unquoteString(i),this.HardCoastlines=this.OceanTheme.lastIndexOf("hard")==this.OceanTheme.length-4&&this.OceanTheme.length>3,this.HardCoastlines&&(this.OceanTheme=this.OceanTheme.substr(0,this.OceanTheme.length-4))):"oceansrc"==a&&isString(i)?this.OceanMapUri=unquoteString(i):"oceangooglesrc"==a&&isString(i)&&(this.OceanMapUri="https://googledrive.com/host/"+unquoteString(i))}},MapConfiguration.prototype.AssignFromUrl=function(e){var t=parseURL(e);if(void 0!==Object.keys&&0==Object.keys(t.params).length&&location.host.indexOf("googledrive.com")>20&&(alert('no "src=" url was specified to scrape the location data from.\n\n(On the off-chance you did specify a src parameter and it\'s gone, then Google Drive could be experiencing problems again:\nSee http://buildingwithblocks.info/googlebug for more details)'),this.Abort=!0),"hidelabelsabove"in t.params&&(this.HideLabelsAbove=t.params.hidelabelsabove),"showlabelsbelow"in t.params&&(this.ShowLabelsBelow=t.params.showlabelsbelow),"range"in t.params&&(this.MapRange=t.params.range),"title"in t.params&&isString(t.params.title)&&(this.Title=decodeURIComponent(t.params.title.replace(/\+/g," "))),"blurb"in t.params&&isString(t.params.blurb)&&(this.Blurb=decodeURIComponent(t.params.blurb.replace(/\+/g," "))),"x"in t.params){var a=parseInt(t.params.x);isNaN(a)||(this.X=a)}if("z"in t.params){var i=parseInt(t.params.z);isNaN(i)||(this.Z=i)}"hideorigin"in t.params&&(this.ShowOrigin=!1),"hidescale"in t.params&&(this.ShowScale=!1),"showorigin"in t.params&&isString(t.params.showorigin)&&(this.ShowOrigin=stringToBool(t.params.showorigin)),"showscale"in t.params&&isString(t.params.showscale)&&(this.ShowScale=stringToBool(t.params.showscale)),"showcoordinates"in t.params&&isString(t.params.showcoordinates)&&(this.ShowCoordinates=stringToBool(t.params.showcoordinates)),"icons"in t.params&&isString(t.params.icons)&&(this.CustomIconsUri=t.params.icons),"googleicons"in t.params&&isString(t.params.googleicons)&&(this.CustomIconsUri="https://googledrive.com/host/"+t.params.googleicons),"src"in t.params&&isString(t.params.src)&&(this.MapDataUri=decodeURIComponent(t.params.src)),"googlesrc"in t.params&&isString(t.params.googlesrc)&&(0==t.params.googlesrc.toLowerCase().indexOf("http")?this.MapDataUri=t.params.googlesrc:(this.MapDataUri="https://googledrive.com/host/"+t.params.googlesrc,t.params.googlesrc.length>40&&(this.GoogleSrcLooksLikeDoc=!0))),"oceansrc"in t.params&&isString(t.params.oceansrc)&&(this.OceanMapUri=t.params.oceansrc),"oceangooglesrc"in t.params&&isString(t.params.oceangooglesrc)&&(this.OceanMapUri=0==t.params.oceangooglesrc.toLowerCase().indexOf("http")?t.params.oceangooglesrc:"https://googledrive.com/host/"+t.params.oceangooglesrc),"oceantheme"in t.params&&isString(t.params.oceantheme)&&(this.OceanTheme=t.params.oceantheme,this.HardCoastlines=this.OceanTheme.lastIndexOf("hard")==this.OceanTheme.length-4&&this.OceanTheme.length>3,this.HardCoastlines&&(this.OceanTheme=this.OceanTheme.substr(0,this.OceanTheme.length-4)))},MapConfiguration.prototype.GetXTranslationFunction=function(e){var t=e/2,a=this.X,i=this.MapRange;return function(e){return(e-a)*t/i+t}},MapConfiguration.prototype.GetZTranslationFunction=function(e){var t=e/2,a=this.Z,i=this.MapRange;return function(e){return(e-a)*t/i+t}},SuppressableLabel.prototype.toString=function(){return this.text},SuppressableLabel.parse=function(e){var t=new SuppressableLabel(e);if(isString(e)){var a=trim(e);a.length>=2&&(a[0]==cLabel_DontDrawChar&&a[a.length-1]==cLabel_DontDrawChar?t=new SuppressableLabel(a.substring(1,a.length-1),LabellingStyleOverride.suppress):a[0]==cLabel_AlwaysDrawChar&&a[a.length-1]==cLabel_AlwaysDrawChar&&(t=new SuppressableLabel(a.substring(1,a.length-1),LabellingStyleOverride.always)))}return t},Location.prototype.getHrefAndTarget=function(e){return new HrefAndTarget("-"==this.hrefOverride?"":isEmpty(this.hrefOverride)&&1!=e?this.type.href:this.hrefOverride)},Location.prototype.getLabel=function(){return isEmpty(this.labelOverride.text)?this.type.name:this.labelOverride.text},Location.prototype.getIconIndex=function(){return isNaN(this.iconIndexOverride)||this.iconIndexOverride<0?this.type.iconIndex:this.iconIndexOverride},Location.prototype.getAlt=function(){var e=this.getLabel();return isEmpty(e)&&!isEmpty(this.owner.text)&&(e=this.owner.text),e},Rectangle.prototype.stroke=function(e,t,a){void 0===t&&(t=0),void 0===a&&(a=0),e.strokeRect(this.x1+t,this.y1+a,this.width,this.height)},Rectangle.prototype.copy=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),new Rectangle(this.x1+e,this.y1+t,this.x2+e,this.y2+t)},Rectangle.prototype.intersects=function(e){return this.x2>e.x1&&this.x1<e.x2&&this.y2>e.y1&&this.y1<e.y2},Rectangle.prototype.equals=function(e){return this.x1==e.x1&&this.y1==e.y1&&this.x2==e.x2&&this.y2==e.y2};var cOceanBlocksPerPixel=16,cWorkingCanvasOversample=4,cColor_Black=new RGB(0,0,0),cColor_White=new RGB(255,255,255);RGB.prototype.Blend=function(e,t){t=0>t?0:t>1?1:t;var a=1-t;return new RGB(Math.round(e.R*t+this.R*a),Math.round(e.G*t+this.G*a),Math.round(e.B*t+this.B*a))},RGB.prototype.MatchesRGB=function(e,t,a){return e==this.R&&t==this.G&&a==this.B},RGB.prototype.Matches=function(e){return e instanceof RGB&&e.R==this.R&&e.G==this.G&&e.B==this.B};